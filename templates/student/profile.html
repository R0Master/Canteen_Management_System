{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Профиль</h2>

<div class="row g-3">

  {# =======================
     ЛИЧНЫЕ ДАННЫЕ
     ======================= #}
  <div class="col-12 col-lg-6">
    <div class="card h-100">
      <div class="card-body">
        <h5 class="card-title mb-3">Данные</h5>

        <div class="mb-1">
          <strong>Имя:</strong> {{ current_user.first_name }}
        </div>
        <div class="mb-1">
          <strong>Фамилия:</strong> {{ current_user.last_name }}
        </div>
        <div class="mb-1">
          <strong>Email:</strong> {{ current_user.email }}
        </div>

        <div class="mt-3">
          <strong>Баланс:</strong>
          {{ '%.2f'|format(current_user.balance or 0) }} ₽
        </div>
      </div>
    </div>
  </div>

  {# =======================
     АЛЛЕРГЕНЫ
     ======================= #}
  <div class="col-12 col-lg-6">
    <div class="card h-100">
      <div class="card-body">
        <h5 class="card-title mb-3">Аллергены</h5>

        {% set als = current_user.allergen_flags or [] %}
        {% set labels = allergen_labels if allergen_labels is defined else {} %}

        {% if als %}
          <div class="mb-3 d-flex flex-wrap gap-2">
            {% for a in als %}
              <span class="badge rounded-pill bg-light text-dark border">
                {{ labels.get(a, a) }}
              </span>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-muted mb-3">
            Аллергены не указаны
          </div>
        {% endif %}

        <a class="btn btn-sm btn-outline-primary"
           href="{{ url_for('pages.student_profile_allergens') }}">
          Редактировать аллергены
        </a>
      </div>
    </div>
  </div>

  {# =======================
     РАЗДЕЛЫ
     ======================= #}
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title mb-3">Разделы</h5>

        <div class="d-flex flex-wrap gap-2">
          <a class="btn btn-outline-secondary"
             href="{{ url_for('pages.student_orders') }}">
            Мои заказы
          </a>

          <a class="btn btn-outline-secondary"
             href="{{ url_for('pages.student_payments') }}">
            История платежей
          </a>

          <a class="btn btn-outline-secondary"
             href="{{ url_for('pages.student_my_reviews') }}">
            Мои отзывы
          </a>
        </div>
      </div>
    </div>
  </div>

</div>

{% endblock %}
