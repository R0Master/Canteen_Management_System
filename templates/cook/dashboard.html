{% extends "base.html" %}
{% block content %}

<div class="container py-3">

    <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 class="m-0">Панель повара</h3>

        <div class="d-flex gap-2 align-items-center">
            <!-- Выбор meal_type -->
            <form method="get" action="{{ url_for('pages.cook_dashboard') }}" class="d-flex gap-2 align-items-center">
                <input type="hidden" name="date" value="{{ selected_date.isoformat() }}">

                <select name="meal_type" class="form-select" onchange="this.form.submit()">
                    <option value="BREAKFAST" {% if meal_type == "BREAKFAST" %}selected{% endif %}>Завтрак</option>
                    <option value="LUNCH" {% if meal_type == "LUNCH" %}selected{% endif %}>Обед</option>
                </select>
            </form>
        </div>
    </div>

    <!-- Календарь/выбор даты (минимально: select на 7 дней) -->
    <form method="get" action="{{ url_for('pages.cook_dashboard') }}" class="mb-3 d-flex gap-2 align-items-center">
        <input type="hidden" name="meal_type" value="{{ meal_type }}">
        <select name="date" class="form-select" style="max-width: 220px;">
            {% for d in date_options %}
            <option value="{{ d.isoformat() }}" {% if d == selected_date %}selected{% endif %}>
                {{ d.strftime("%d.%m.%Y") }}
            </option>
            {% endfor %}
        </select>
        <button class="btn btn-primary" type="submit">Показать</button>
    </form>

    <div class="row g-3">
        <div class="col-12 col-lg-6">
            {% include "cook/_prepare_column.html" %}
        </div>

        <div class="col-12 col-lg-6">
            {% include "cook/_issue_column.html" %}
        </div>
    </div>

    <div><br></div>

    <!-- ===== СКЛАД (сводка) ===== -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div class="fw-semibold">Склад</div>
              <div class="text-muted small">
                Проверка на {{ stock_horizon_label }} от {{ stock_base_date.strftime("%d.%m.%Y") }}
              </div>
            </div>
    
            <a class="btn btn-sm btn-outline-primary" href="{{ url_for('pages.cook_inventory') }}">
              Открыть склад
            </a>
          </div>
    
          <hr class="my-3">
    
          {% if stock_ok %}
            <div class="alert alert-success mb-0">
              Остатков хватает на {{ stock_horizon_label }}.
            </div>
          {% else %}
            <div class="alert alert-warning mb-0">
              Нужна закупка: дефицит по {{ stock_deficit_count }} позициям.
              <a class="alert-link" href="{{ url_for('pages.cook_inventory') }}">Перейти на склад</a>.
            </div>
          {% endif %}
        </div>
      </div>
    

</div>
{% endblock %}
